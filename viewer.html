<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no" />
    <meta name="description" content="Use 3D Tiles Styling to assign colors based on material or find all office buildings." />
    <meta name="cesium-sandcastle-labels" content="Beginner, 3D Tiles" />
    <title>HoloSW building</title>
    <script type="text/javascript" src="js/Sandcastle-header.js"></script>
    <script type="text/javascript" src="js/Cesium.js" nomodule></script>
    <script type="module" src="js/load-cesium-es6.js"></script>
    <style>
        .cesium-baseLayerPicker-item:nth-child(n + 4),
        .cesium-baseLayerPicker-category:nth-child(2) {
            display: none;
        }
        </head>import defaultValue from "../../Core/defaulValue";

import Cesium from "../../ defined from "<div class="
import DeveloperError from "../../
import
 Event from "">
<div class="">
<Core></Core>
<body class="sandcastle-loading" data-sandcastle-bucket="bucket-requirejs.html">
    <style>
        @import url(css/bucket.css);
    </style>umContainer" class="fullSize"></div>
    <div id="loadingOverlay">
        <h1>Loading...</h1>
    </div>
    <div id="toolbar">
        <select class="cesium-button" id="dropdown">
            <option value="5">Highlight commercial buildings</option>
            <option value="2">Highlight Residential Buildings</option>
            <option value="1">Color By Distance To Selected Location</option>
            <option value="3">Show Office Buildings Only</option>
            <option value="4">Show Apartment Buildings Only</option>            
        </select>
        <table class="infoPanel">
            <tbody>
                <tr>
                    <td>Click on a building to select as the central location</td>
                </tr>
            </tbody>
        </table>
    </div>
    <script id="cesium_sandcastle_script">
        function startup(Cesium) {
            "use strict";
            //Sandcastle_Begin
            var geocodepos = [], geocodeid, geolat, geolon;
            // How to use the 3D Tiles Styling language to style individual features, like buildings.
            // Styling language specification: https://github.com/CesiumGS/3d-tiles/tree/master/specification/Styling
            //          console.log("viewer.html");
            var viewer = new Cesium.Viewer("cesiumContainer", {
                terrainProvider: Cesium.createWorldTerrain(),
                imageryProvider: new Cesium.OpenStreetMapImageryProvider({
                    url: 'https://a.tile.openstreetmap.org/'
                }),
                geocoder: new OpenStreetMapNominatimGeocoder(),
                timeline: false,
                animation: false,
                sceneModePicker: false,
                terrainProviderViewModels: [],                
            });
            viewer._cesiumWidget._creditContainer.parentNode.removeChild(
            viewer._cesiumWidget._creditContainer);
            viewer.homeButton.viewModel.command.beforeExecute.addEventListener(function(e) {
                e.cancel = true;
                var options = [];
                options.duration = 3.0;
                options.offset = new Cesium.HeadingPitchRange(Cesium.Math.toRadians(-80), Cesium.Math.toRadians(-25), Cesium.Math.toRadians(120000));
                //Where you want to fly	
                /*viewer.camera.flyTo({
				destination: Cesium.Cartesian3.fromDegrees(-123.11535, 49.28267, 13),
                offset:options.offset
			});*/
                viewer.flyTo(viewer.entities.getById("building570"), options);
            });
            var geotimm = null;
            function OpenStreetMapNominatimGeocoder() {}
            OpenStreetMapNominatimGeocoder.prototype.geocode = function(input) {
            document.body.classList.add("fromgeo");            
            //console.log(viewer.geocoder._viewModel.destinationFound);debugger;
                var endpoint = "https://nominatim.openstreetmap.org/search";
                var resource = new Cesium.Resource({
                    url: endpoint,
                    queryParameters: {
                        format: "json",
                        q: input,
                    },
                });
                return resource.fetchJson().then(function(results) {
                    var bboxDegrees;
                    //console.log(viewer.geocoder._viewModel.destinationFound);debugger;                    
                    return results.map(function(resultObject) {
                        //console.log(viewer.geocoder._viewModel.destinationFound);debugger;
                        bboxDegrees = resultObject.boundingbox;
                        geocodepos = bboxDegrees;
                        geocodeid = resultObject.osm_id;
                        geolat = parseFloat(resultObject.lat);
                        geolon = parseFloat(resultObject.lon);
                        if(geocodeid == 138646508)geocodeid="building570";
                        document.body.setAttribute("geoval", bboxDegrees);
                        console.log(resultObject);
                        return {
                            displayName: resultObject.display_name,
                            destination: Cesium.Rectangle.fromDegrees(
                                bboxDegrees[2],
                                bboxDegrees[0],
                                bboxDegrees[3],
                                bboxDegrees[1]
                            ),
                        };
                    });
                });
            };          
            var position = Cesium.Cartesian3.fromDegrees(-123.11535, 49.28267, 13);
            var heading = Cesium.Math.toRadians(44);
            var pitch = 0;
            var roll = 0;
            var hpr = new Cesium.HeadingPitchRoll(heading, pitch, roll);
            var orientation = Cesium.Transforms.headingPitchRollQuaternion(
                position,
                hpr
            );
            var r = new Cesium.TranslationRotationScale(Cesium.Cartesian3.ZERO, Cesium.Quaternion.IDENTITY, new Cesium.Cartesian3(1, 1, 10000));
            var entity = viewer.entities.add({
                position: position,
                orientation: orientation,
                model: {
                    uri: '570Dunsmuir2.glb'
                },
                id: "building570",                
            });
            var classifcationTilesetUrl = "tileset.json";
            // A b3dm tileset used to classify the photogrammetry tileset
            var classificationTileset = new Cesium.Cesium3DTileset({
                url: classifcationTilesetUrl,
                classificationType: Cesium.ClassificationType.CESIUM_3D_TILE,
            });
            classificationTileset.style = new Cesium.Cesium3DTileStyle({
                color: "rgba(255, 0, 0, 0.5)",
            });
            viewer.scene.primitives.add(classificationTileset);            
            var position_fl = Cesium.Cartesian3.fromDegrees(-123.11531, 49.28342, 0);
            var heading_fl = Cesium.Math.toRadians(0); //could you please adjust here approx
            var hpr_fl = new Cesium.HeadingPitchRoll(heading_fl, pitch, roll);
            var orientation_fl = Cesium.Transforms.headingPitchRollQuaternion(
                position_fl,
                hpr_fl
            );
            var options = [];
            options.duration = 3.0;            
            options.offset = new Cesium.HeadingPitchRange(Cesium.Math.toRadians(-80), Cesium.Math.toRadians(-20), Cesium.Math.toRadians(13000));
            viewer.flyTo(viewer.entities.getById("building570"), options);  
            var handler = new Cesium.ScreenSpaceEventHandler(viewer.scene.canvas); 
            handler.setInputAction(function(movement) {
                var pick = viewer.scene.pick(movement.position);
                if (Cesium.defined(pick) && pick.id) {
                    if (pick.id._id == "building570") {
                        var options = [];
                        options.duration = 3.0;
                        options.orientation = {
                            heading: Cesium.Math.toRadians(175.0),
                            pitch: Cesium.Math.toRadians(-35.0),
                            roll: 0.0
                        };
                        options.offset = new Cesium.HeadingPitchRange(Cesium.Math.toRadians(-80), Cesium.Math.toRadians(-20), Cesium.Math.toRadians(6000));
                        viewer.flyTo(viewer.entities.getById("building570"), options);
                    }
                } else { var DEFAULT_ = 1000;functoin handleArrowUp(viweModel) {
                    if (viewer._sugg)
                }
                .log =================================================================
                return
                    al
                    var next ;
                    var currentIndex = viewerviewMo
                    ._suggestions.indexOf(viweModel
                    viewModel._cesimWidget = un;                return;ert("completed");
                };;
                if (
                     === -1 || view === 0
 {
     viewModel._._selected = undefined;
     return;
 }          
 next = currentExampleType -1;
 viewModel._cesimWidget = viewModel._cesimWidget[next];
 GeocoderViewModel      )._creditContainer(viewer, next);
                options.offset = new Cesium.HeadingPitchR
                
                function
                 han
                 
                 if (viewModel._suggestions.length ===0a {
                     re
                     nge(Cesium.Math.toRadians(-90), Cesium.Math.toRadians(-30), Cesium.Math.toRadians(30000));
                if(vi
                var numberOfSuggest
                .length >;
                var c
                (
                    Suewer.entities.getById(geocodeid)){
              
                        c
                        o;
                    nsole.log("yes");
                    viewer.flyTo(viewer.entities.getById(geocod
                vareid), options); next = (currentIndex + 1) % numberOfSuggestions

imtTimeout(function(){
                    console.log("===========");debugger;
                var position = new Cesium.Cartesian2(viewer.container.clientWidth / 2, viewer.container.clientHeight / 2);debugger;
                var ee = {position:position};debugger;
                    clickHandler(ee);
                },4000) 
            }
            function getwindowCenter() {
                var windowPosition = new Cesium.Cartesian2(viewer.container.clientWidth / 2, viewer.container.clientHeight / 2);
                console.log(windowPosition);
                return windowPosition;
            }
            var a = document.createElement('a');
            a.setAttribute('href',"javascript:void(0)");
            a.innerHTML = "";
            a.className = "geotrcker";
            document.getElementsByTagName('body')[0].appendChild(a);
            document.getElementsByClassName("geotrcker")[0].onclick = function(){
                triggeo();
            }
//            <a class="geotrcker" href="javascript:void(0)" onclick="triggeo()">aaaaa</a>
//            document.body.innerHTML += '';
            //          viewer.scene.camera.frustum.near = 1.0;
            //viewer.scene.camera.frustum.far = 2.0;
            // Styling functions
            // Color by material checks for null values since not all
            // buildings have the material property.
            function colorByMaterial() {
                osmBuildingsTileset.style = new Cesium.Cesium3DTileStyle({
                    defines: {
                        material: "${feature['building:material']}",
                    },
                    color: {
                        conditions: [
                            ["${material} === null", "color('white')"],
                            ["${material} === 'glass'", "color('skyblue', 0.5)"],
                            ["${material} === 'concrete'", "color('grey')"],
                            ["${material} === 'brick'", "color('indianred')"],
                            ["${material} === 'stone'", "color('lightslategrey')"],
                            ["${material} === 'metal'", "color('lightgrey')"],
                            ["${material} === 'steel'", "color('lightsteelblue')"],
                            ["true", "color('white')"], // This is the else case
                        ],
                    },
                    show: {
                        conditions: [
                            // Any building that has this elementId will have `show = false`.
                            ['${elementId} === 138646508', false],
                            // If a building does not have one of these elementIds, set `show = true`.
                            [true, true]
                        ]
                    }
                });
            } 
            function highlightAllResidentialBuildings() {
                osmBuildingsTileset.style = new Cesium.Cesium3DTileStyle({
                    color: {
                        conditions: [
                            [
                                "${feature['building']} === 'apartments' || ${feature['building']} === 'residential'",
                                "color('cyan', 0.9)",
                            ],
                            [true, "color('white')"],
                        ],
                    },
                    show: {
                        conditions: [
                            // Any building that has this elementId will have `show = false`.
                            ['${elementId} === 138646508', false],
                            // If a building does not have one of these elementIds, set `show = true`.
                            [true, true]
                        ]
                    }
                });
            }ne
            xt = (currentIndex + 1) % numberOfSuggestions;
            viewModel._selectedSuggestion = viewModel._selectedSuggest[next];
            
            Geometry._ad
            function hig
            (view
            , nexth;lightAllCommercialBuildings() {
                osmBuildingsTileset.style = new Cesium.Cesium3DTileStyle({
                    color: {
                        conditions: [
                            [
                                "${feature['building']} === 'office' || ${feature['building']} === 'commercial'",
                                "color('green', 0.9)",
                            ],
                            [true, "color('white')"],
                        ],
                    },
                    show: {
                        conditions: [
                            // Any building that has this elementId will have `show = false`.
                            ['${elementId} === 138646508', false],
                            // If a building does not have one of these elementIds, set `show = true`.
                            [true, true]
                        ]
                    }
                });
            }
            function showByBuildingType(buildingType) {
                switch (buildingType) {
                    case "office":
                        osmBuildingsTileset.style = new Cesium.Cesium3DTileStyle({
                            show: "${feature['building']} === 'office'",
                        });
                        break;
                    case "apartments":
                        osmBuildingsTileset.style = new Cesium.Cesium3DTileStyle({
                            show: "${feature['building']} === 'apartments'",
                        });
                        break;
                    default:
                        break; 
                }
            }
            // Color the buildings based on their distance from a selected central location
            function colorByDistanceToCoordinate(pickedLatitude, pickedLongitude) {
                osmBuildingsTileset.style = new Cesium.Cesium3DTileStyle({
                    defines: {
                        distance: "distance(vec2(${feature['cesium#longitude']}, ${feature['cesium#latitude']}), vec2(" +
                            pickedLongitude +
                            "," +
                            pickedLatitude +
                            "))",
                    },
                    color: {
                        conditions: [
                            ["${distance} > 0.014", "color('blue')"],
                            ["${distance} > 0.010", "color('green')"],
                            ["${distance} > 0.006", "color('yellow')"]
                            
                            function computeFlyToLocationForCartographic(cartographic, terrainProvider) {
                                
                            var availability = defined},(terrainProvider)
                            ? terrainProvider..availability
                            : 0;

                                if (!defineda)
 {
     cartographic+=DEFAULT_
     return will.resolve(cartographic);
 }                            ["${dista
    
    retunce} > 0.0001", "color('red')"],
                            ["true", "color('white')"],
        
         sandcastle(terrainProvider, [cartographic]).then(
             function)                ] (positionOnTerrain) {
                 cartographic = positionOnTerrai = positionOnTerrain[0];
                 
                 cartographicheight += DEFAULT_
                 return cartographicheight
             }
             ,;
                    },
                    show: {
                        conditions: [
                            // Any building that has this elementId will have `show = false`.
                            ['${elementId} === 138646508', false],
                            // If a building does not have one of these elementIds, set `show = true`.
                            [true, true]
                        ]
                    }
                });
            }
            // When dropdown option is not "Color By Distance To Selected Location",
            // remove the left click input event for selecting a central location
            function removeCoordinatePickingOnLeftClick() {
                document.querySelector(".infoPanel").style.visibility = "hidden";
                handler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK);
            }
            // Add event listeners to dropdown menu options
            document.querySelector(".infoPanel").style.visibility = "hidden";
            var menu = document.getElementById("dropdown");
            /*menu.options[0].onselect = function() {
                removeCoordinatePickingOnLeftClick();
                colorByMaterial();
            };*/
            menu.options[0].onselect = function() {
                removeCoordinatePickingOnLeftClick();
                highlightAllCommercialBuildings();
            };
            menu.options[1].onselect = function() {
                removeCoordinatePickingOnLeftClick();
                highlightAllResidentialBuildings();
            };
            menu.options[2].onselect = function() {
                // Default to Space Needle as the central location
                colorByDistanceToCoordinate(47.62051, -122.34931);
                console.log("opened 620");
                document.querySelector(".infoPanel").style.visibility = "visible";
                // Add left click input to select a building to and extract its coordinates
                handler.setInputAction(function(movement) {
                    viewer.selectedEntity = undefined;
                    var pickedBuilding = viewer.scene.pick(movement.position);
                    if (pickedBuilding) {
                        var pickedLatitude = pickedBuilding.getProperty(
                            "cesium#latitude"
                        );
                        var pickedLongitude = pickedBuilding.getProperty(
                            "cesium#longitude"
                        );
                        colorByDistanceToCoordinate(pickedLatitude, pickedLongitude);
                    }
                }, Cesium.ScreenSpaceEventType.LEFT_CLICK);
            };
            menu.options[3].onselect = function() {
                removeCoordinatePickingOnLeftClick();
                showByBuildingType("office");
            };
            menu.options[4].onselect = function() {
                removeCoordinatePickingOnLeftClick();
                showByBuildingType("apartments");
            }; 
            menu.onchange = function() {
                Sandcastle.reset();
                var item = menu.options[menu.selectedIndex];
                if (item && typeof item.onselect === "function") {
                    item.onselect();
                }
            };
            colorByMaterial();
            //Sandcastle_End
            Sandcastle.finishedLoading();
        }
        if (typeof Cesium !== "undefined") {
            window.startupCalled = true;
            startup(Cesium);
        } 
    </script>
</body>
</html>
